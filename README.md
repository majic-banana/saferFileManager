# saferFileManager
课程设计：前后端分离的安全网盘系统（开发周期：一个星期）

**摘  要**

关键词：身份认证，访问控制，前后端分离，文件分享，用户管理。

本系统是，用java 实现的，基于B/S、MVC架构的前后端分离Web应用系统，主要功能包括文件上传、文件下载、文件删除、文件分享、用户注册、用户登入、身份认证、访问控制(权限管理)、输入过滤、用户管理。报告接下来将从需求分析、可行性分析、概要设计、详细设计、系统实现和系统测试几个方面展开系统的构建过程

 

 

# 一、 需求分析

该系统主要面向用户，提供文件管理、用户身份验证及管理功能。用户通过注册和登录进入系统后，可以执行文件的上传、下载、展示、删除及分享操作。同时，系统具备安全性模块，确保用户操作的安全和数据的保护。此外，系统还包括用户管理功能，方便管理员对用户进行管理和维护。整体设计旨在提升用户体验，确保数据安全，并实现高效的文件管理。

## 1.1 用户交互需求

用户入门：用户可以通过系统的初始界面选择注册或登录。

注册功能：用户需提供必要的信息以创建新账户，成功后将引导用户进入个人信息界面。

登录功能：用户可以输入凭证（用户名和密码）以访问其账户。

## 1.2 安全性需求

安全性模块是系统的核心部分，包括以下具体功能：1.用户输入处理（User Input）：系统需接收用户输入的信息，包括注册和登录时的用户名和密码。2.身份验证（Authentication）：系统需验证用户的凭证，确保其有效性。只有通过验证的用户才能进入系统。3.授权（Authorization）：系统需根据用户的身份和权限，决定其访问哪些特定功能和数据。确保不同用户只能访问其有权访问的资源。4.输入过滤（Input Filter）：系统需对用户输入进行过滤，防止恶意输入和SQL注入等攻击，确保系统的安全性。5.请求与警告处理：系统需具备处理用户请求和警告的能力，以便及时反馈和响应用户操作。

## 1.3 文件管理需求

文件上传：用户可以将文件上传至系统，支持多种文件格式。

文件下载：用户可以从系统中下载已存储的文件。

文件展示：用户可以查看文件的内容，支持预览功能。

文件删除：用户可以选择删除指定文件，系统需提供确认机制以避免误操作。文件数据处理：系统应支持与文件相关的数据管理功能，便于用户对文件的全面管理。

## 1.4 分享功能需求

文件分享：用户在进行文件操作后，可以选择分享文件，系统需支持链接生成或直接分享给其他用户。

## 1.5 用户管理需求

用户信息管理：系统应提供用户信息模块，用户可更新个人信息。

管理员功能：系统应包括用户管理功能，管理员可以查看、编辑或删除用户信息，以维护系统的稳定性和安全性。

## 1.6 数据需求

 

三个实体：User,DiskFile,Share

![image](https://github.com/user-attachments/assets/43f1193f-a495-4487-b756-5bf90ca5c0bc)


图1: ER图

# 二，可行性分析

## 2.1 现有技术支持

开发框架与工具：当前市场上有多种成熟的开发框架和工具可供选择，包括：

前端框架：如React、Vue.js等，能够实现响应式设计和良好的用户体验。

后端技术：如Node.js、Django等，支持高效的服务器端开发，能够处理用户请求和数据管理。

数据库支持：系统可以采用关系型数据库（如MySQL、PostgreSQL）或非关系型数据库（如MongoDB）进行数据存储，满足不同数据结构的需求。

 

2.2数据流图分析：

系统的数据流主要围绕用户输入、身份验证、文件操作和用户管理展开。数据在各个模块之间流动，确保用户能够顺利完成注册、登录和文件管理等操作。

 

![wps2](https://github.com/user-attachments/assets/5cc92523-7ca1-4653-a0ef-ba4e430a82d9)

图2：整体数据流图

 

1. 用户输入

用户（User）：用户通过界面输入必要的信息进行注册或登录。这些输入数据（如用户名、密码等）是数据流的起点。

2. 安全性模块

用户提交的凭证（如用户名和密码）被传递到“Security”模块进行验证。

如果验证失败，系统会返回相应的错误信息，阻止后续操作。

 

![wps3](https://github.com/user-attachments/assets/0393776c-0142-4568-9429-783d32974b61)

图3：security数据流分解图

 

 

（1）.用户输入（userInput）：用户通过界面提交的输入数据（如用户名和密码）是数据流的起点。（2）身份验证（Authentication）：用户输入数据流向身份验证模块，系统对输入的凭证进行检查，确认用户身份的有效性。

如果验证成功，数据流向下一个模块；如果失败，系统将返回错误信息，阻止后续流程。（3）授权（Authorization）：一旦身份验证通过，数据继续流向授权模块。此模块检查用户是否具备执行特定操作的权限。

授权结果决定数据流的走向：如果用户被授权，则继续；如果未授权，系统返回错误信息。（4）输入过滤（InputFilter）：在用户获得授权后，数据流入输入过滤模块，系统对用户输入进行格式和安全性验证，确保输入符合系统要求。通过验证后，数据流向后续处理步骤；如果过滤不通过，系统会返回错误信息，阻止请求执行。

 

 

**3. 登录与注册**

登录（Login）：成功验证后，用户的会话信息（如会话ID和用户信息）被存储在服务器端，供后续操作使用。

注册（Register）：新用户的注册信息被提交并存储到用户数据库中，生成新的用户记录。

**4. 文件管理操作**

一旦用户通过身份验证，数据流向文件管理模块：

(1) 文件展示（FileShow）：系统从数据库中检索文件信息并发送给用户进行展示。

(2) 下载（Download）：用户请求下载文件，系统将文件数据流回用户。

(3) 删除（Delete）：用户请求删除特定文件，系统将删除请求和文件标识发送至数据库进行处理。

(4) 分享（Share）：用户选择分享文件，系统生成分享链接或权限信息并流向相关用户。

**5. 用户管理**

用户信息（UserInfo）：用户信息检索请求被发送到管理模块，系统返回用户的详细信息，以供用户查看和编辑。

用户管理（UserManager）：管理员对用户信息的修改请求通过数据流传递至数据库，更新用户记录。

 

 

## 2.3 安全性实现

(1) 身份验证：系统可以使用现有的安全框架和库（如JWT、OAuth2）实现用户身份验证，确保只有授权用户能够访问系统。

(2) 授权管理：通过角色权限管理机制，可以实现对不同用户访问权限的控制，确保用户只能访问其有权访问的功能和数据。

(3) 输入过滤：系统需实现输入验证和过滤机制，防止恶意输入和SQL注入等攻击。可以使用现有的验证库（如validator.js）来实现。

## 2.4 系统集成

模块化设计：系统设计为模块化结构，便于与其他系统和服务进行集成。可以与现有的文件存储服务（如AWS S3、Azure Blob Storage）进行对接，确保文件管理的灵活性。

API接口：系统应提供RESTful或GraphQL接口，便于前端与后端的数据交互，同时支持第三方应用集成。

## 2.5 兼容性与扩展性

跨平台兼容性：系统应支持多种操作系统（如Windows、Linux、macOS）和设备（如桌面、平板、手机），确保用户在不同环境下均可方便地使用。

可扩展性：系统架构应具备良好的扩展性，能够支持未来功能的增加和用户量的增长，确保系统长期可用。

## 2.5 维护与支持

技术支持团队：在系统上线后，需建立技术支持团队，负责系统的维护和用户问题的解决，确保系统的稳定运行。

持续更新与改进：系统应具备定期更新和改进机制，及时修复安全漏洞和提升功能，确保技术的前沿性和系统的安全性。

# 三，概要设计

本系统旨在为用户提供一个集成的文件管理解决方案，涵盖用户注册、登录、安全性验证、文件操作及权限管理等功能。通过对系统模块的详细设计，确保系统具备良好的安全性、灵活性和可扩展性，以满足未来可能的需求变化。在本报告中，将详细介绍系统的整体架构、主要功能模块及其具体实现方式，重点分析各个模块之间的交互流程，确保设计方案的可行性和有效性。报告将以总分结构呈现，首先概述系统的总体设计目标和架构，然后逐一细分各个功能模块，最后总结其安全性和用户管理策略，以提供清晰、系统的设计思路。

 

系统由以下主要模块组成：

![wps4](https://github.com/user-attachments/assets/e634d681-5621-41e6-84e8-8228f9d81df9)

图4：系统层次图

## 3.1 用户模块

(1) 用户注册：用户可以通过提供必要信息完成注册。

(2) 用户登录：已注册用户可以通过输入用户名和密码进行登录。

(3) 用户管理：对于管理员，除了上述两种功能外还有用户管理功能

## 3.2 安全性模块

(1) 身份验证（Authentication）：检查用户凭证的有效性，确保用户身份的真实性。

(2) 授权（Authorization）：在用户身份验证通过后，检查用户的操作权限是否满足。

(3) 输入过滤（Input Filter）：对用户输入进行验证，确保输入的数据符合预设标准，防止恶意攻击。

## 3.3 文件管理模块

上传：用户可以将文件上传到系统。下载：用户可以从系统中下载文件。

删除：用户可以删除存储在系统中的文件。分享：用户可以分享文件给其他用户。

## 3.4 权限控制模块

对用户的操作进行权限控制，确保用户只能访问和操作其有权使用的功能。

## 3.5 管理员模块

用户管理：管理员可以对用户进行管理，包括添加、删除和修改用户信息。

## 3.6登录流程

用户输入用户名和密码。系统查询后端数据库，检查用户信息是否存在。如果用户存在，生成会话并存储用户信息，返回会话ID。

用户成功登录后进入主页面。

![wps5](https://github.com/user-attachments/assets/1847d41a-6691-4d5e-aab5-3904dfb84e27)

图5：登入概要流程图

## 3.7 文件操作以及用户管理流程

(1) 用户在登录状态下选择文件操作（上传、下载、删除或分享）。

(2) 系统进行身份验证，确保用户已登录。

(3) 系统检查用户权限，确认其对所选操作的访问权限。

(4) 系统对用户输入进行过滤，检查输入的数据是否合法。

(5) 如果所有验证通过，执行对应的文件操作（或用户管理）。

 

![wps6](https://github.com/user-attachments/assets/e527dd12-5ec9-48a3-a935-6384a65ef1f0)

图6：文件操作+用户管理概要流程图

# 四，详细设计

## 4.1类图

主要包括Controller，Serivece, Interceptor,entity,Mapper

 

![wps7](https://github.com/user-attachments/assets/c251bfe4-b3a2-4254-8c57-261480f09087)

图7：Controller 类图

 

![wps8](https://github.com/user-attachments/assets/b24b5b6d-c8d2-40fd-9927-339268dceb41)

图8：Interceptor 类图

![wps9](https://github.com/user-attachments/assets/52e16bef-db65-4aa1-80ab-aa9da41c97e5)

图9：entity 类图

![wps10](https://github.com/user-attachments/assets/a9ec0ba9-9eed-4617-b5d6-db99a4c664a7)

图10:Serivice And Mapper(DAO)

 

## 4.2 时序图

![wps11](https://github.com/user-attachments/assets/d3896050-02f2-419b-8cfd-e5b6aba1383b)

图11：登入时序图

![wps12](https://github.com/user-attachments/assets/f92ed031-8544-4acb-89fc-a1d4da6682bd)

图12：文件分享

 

![wps13](https://github.com/user-attachments/assets/d770a1ac-6084-47e8-a2b7-718a3da7a616)

图13：文件CRUD（以上传为例）

![wps14](https://github.com/user-attachments/assets/6e289835-4fd3-4f0a-8841-65774f806783)
图14：用户管理（以添加用户为例）

 

# 五，系统实现

## 5.1开发环境

操作系统：Windows 11

前端：Node.js ,Vue3；

后端：java17,maven,spring boot,MyBatis,Spring Web

## 5.2 运行环境

操作系统：Windows 11

前端：Node.js ,Vue3

后端：java17,maven,spring boot,MyBatis,Spring Web

## 5.3 调试环境

前端：Vscode

后端：Idea

 

## 5.4 实现效果

(1) 登入

![wps15](https://github.com/user-attachments/assets/7b2f0e69-338b-437d-8047-45a8bdfca3f5)

(2) 注册

图15：登入页面

![wps16](https://github.com/user-attachments/assets/3a2e172e-6d2c-4466-8ea5-90b5ed7d0b5c)

图16：注册页面

 

(3) 文件管理（管理员模式）：

右键可以选择文件操作：删除，分享，下载。与普通用户的区别是，管理员用户能够管理所有用户的文件，而普通用户只能管理自己的文件。

![wps17](https://github.com/user-attachments/assets/437ce048-3387-41cf-b84a-c12b98c25bd2)

图17：文件管理（管理员模式）

分享下载页面：文件分享后会生成文件的Hash值，输入分享文件的hash值能够下载该文件。其本质是分享链接的一种简化

![wps18](https://github.com/user-attachments/assets/7c391e51-d0d3-42a8-9cbb-448428906466)

图18：分享下载

文件上传，输入上传路径，并选择本地文件后即可上传到用户目录下

![wps19](https://github.com/user-attachments/assets/acf295f5-328c-400b-b03c-640a1d62b2cb)

图19：文件上传

(4) 用户管理：用户查询，用户添加，用户删除，用户修改。

![wps20](https://github.com/user-attachments/assets/fd4527d5-f5ed-473a-b1c0-b736451b72ae)

图20：用户管理

 

# 六，系统测试

系统测试主要测试其安全性，因此在此给出其相应的测试方案

***\*表1\**** 1.AuthenticationInterceptor 测试用例方案

| 测试用例编号 | 测试场景             | 输入条件               | 预期结果                                                  |
| ------------ | -------------------- | ---------------------- | --------------------------------------------------------- |
| TC-AI-001    | 会话不存在           | 无有效会话             | 返回错误结果，状态码为200，错误信息为AUTHENTICATION_ERROR |
| TC-AI-002    | 会话存在但用户未登录 | 会话中没有"userId"属性 | 返回错误结果，状态码为200，错误信息为AUTHENTICATION_ERROR |
| TC-AI-003    | 会话存在且用户已登录 | 会话中有"userId"属性   | 允许请求继续处理                                          |

 

***\*表\*******\*2\**** 1.AuthorizationInterceptor 测试用例方案

| 测试用例编号 | 测试场景             | 输入条件             | 预期结果                                                 |
| ------------ | -------------------- | -------------------- | -------------------------------------------------------- |
| TC-AZ-001    | 会话不存在           | 无有效会话           | 返回错误结果，状态码为200，错误信息为AUTHORIZATION_ERROR |
| TC-AZ-002    | 会话存在但用户未登录 | 会话中没有"role"属性 | 返回错误结果，状态码为200，错误信息为AUTHORIZATION_ERROR |
| TC-AZ-003    | 用户角色优先级足够   | 有效角色且权限匹配   | 允许请求继续处理                                         |
| TC-AZ-004    | 用户角色优先级不足   | 有效角色但权限不匹配 | 返回错误结果，状态码为200，错误信息为AUTHORIZATION_ERROR |

 

***\*表\*******\*3\**** 1.FileInterceptor（输入过滤）  测试用例方案

| 测试用例编号 | 测试场景                  | 输入条件       | 预期结果                                      |
| ------------ | ------------------------- | -------------- | --------------------------------------------- |
| TC-FI-001    | 用户角色为ADMIN           | 有效的用户路径 | 允许请求继续处理                              |
| TC-FI-002    | 用户角色非ADMIN且路径合法 | 有效的用户路径 | 允许请求继续处理                              |
| TC-FI-003    | 路径不合法                | 无效的用户路径 | 返回错误结果，状态码为200，错误信息为BAD_PATH |

##  

 

 

 

 

 

 

 

 

 

 

 

 

# 参考

[1] Apache Shiro | Simple. Java. Security,https://shiro.apache.org/reference.html

[2] 跨域请求response中有Set-cookie,但是Cookie无法写入浏览器问题 - 隐隐隐 - 博客园，   https://www.cnblogs.com/yinyinyin/p/13523966.html)

[3] vue3.0路由跳转useRouter执行后undefined问题-踩坑笔记_userouter undefined-CSDN博客，https://blog.csdn.net/Leslie_hxd/article/details/120762894

[4] 张海潘 牟永敏.软件工程导论(第6版)[C]. 北京: 清华出版社, 2013年8月: 40-141

[5] 朴勇 周勇.软件工程[C]. 北京: 电子工业出版社, 2019年8月: 7-95
